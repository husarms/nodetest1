extends ../layout

block content
    style(text='text/css').
        pre.prettyprint {
            border: 1px solid #ccc;
            margin-bottom: 0;
            padding: 9.5px;
            white-space: pre-wrap;
        }
    div.breadcrumbs
        div.container
            a(href='/blog')
                h1.pull-left Blog
            ul.pull-right.breadcrumb
                li
                    a(href='/') Home
                li
                    a(href='/blog') Blog
                li.active
                    a(href='')=title
    //-End Breadcrumbs
    div.container.content-sm
        div.news-v3.margin-bottom-60
            div.news-v3-in.bg-color-darker.col-md-10.col-md-offset-1
                div.row
                    div.col-md-10.col-md-offset-1
                        div(ng-app="myApp" ng-controller="myCtrl")
                            h2.Title=title
                                small &nbsp;
                            ul.list-inline.posted-info
                                li Matt Husar
                                li March 3, 2016
                            hr
                            //-Code snippet with pretty print
                            p.
                                For this post I wanted to work through a basic example of requesting data from an external API and displaying it on a page. We will be using the Instagram API as our data source, making requests via http, getting JSON data back and using a bit of Angular to display it.
                            p.
                                The end result allows the user to search for an Instagram tag and get a listing of matching tags along with their media count -

                            //-Step 1 - Direct your user to our authorization URL
                            div(ng-show="accessToken == null")
                                p
                                    div.input-group
                                        span.input-group-btn
                                            a.btn-u.btn-brd-hover(type="button" href='https://api.instagram.com/oauth/authorize/?client_id=2aaa8ce013bc4a1291054e1ff79481f4&redirect_uri=http://localhost:3000/blog/posts/instagram-api&response_type=token') Get Access Token
                            //-Step 2 - Request Data
                            div(ng-show="accessToken != null")
                                p.
                                    <i class="fa fa-check-square-o"></i> Access granted - token = {{accessToken}}
                                p
                                    div.input-group
                                        span.input-group-btn
                                            button.btn-u.btn-brd-hover(type="button",ng-click='getTagData()') <i class="fa fa-search"></i> Search Tags
                                        input.form-control(type="text", placeholder="Enter a tag name", ng-model="searchQuery")
                                div.alert.alert-warning(ng-hide="message == null")
                                    a.close(ng-click="message = null", aria-label="close") &times;
                                    p {{message}}
                                table.table.table-condensed.table-hover(ng-show="tags")
                                    thead
                                        td Tag Name
                                        td Media Count
                                    tr(ng-repeat="tag in tags")
                                        td {{tag.name}}
                                        td {{tag.media_count}}
                            br
                            h3.
                                Getting access to the Instagram API
                            p.
                                Way back when, certain parts of the Instagram API were accessible without authentication. This made it popular with developers who wanted an easy way to play around with a REST API. It is much more locked down these days, and requires a bit of setup work before you can start making requests.
                            p.
                                First you will need to 'register' your application with Instagram. Once it has been 'approved' it will be assigned a client id. Check out the <a href="https://www.instagram.com/developer/">Instagram developer page</a> for more information.
                            p.
                                This client id will then be included in each request you make to the API -
                            p
                                pre.prettyprint.
                                    &lt;a href="https://api.instagram.com/oauth/authorize/?client_id=2aaa8ce013bc4a1291054e1ff79481f4&amp;redirect_uri=http://localhost:3000/blog/posts/instagram-api&amp;response_type=token&amp;scope=public_content"&gt;
                                        Instagram Authorization Link
                                    &lt;/a&gt;

                            h3 Issuing a request
                            p Javascript
                                pre.prettyprint.
                                    //Search for tag data
                                    $scope.getTagData = function(){
                                        $scope.message = null;
                                        //Validate input
                                        if($scope.searchQuery === undefined){
                                            $scope.message = "Please enter search criteria";
                                        }
                                        //Send http request to API
                                        else{
                                            $http.jsonp('https://api.instagram.com/v1/tags/search?' +
                                                    'q=' + $scope.searchQuery +
                                                    '&access_token=' + $scope.accessToken +
                                                    '&callback=JSON_CALLBACK')
                                                    .then(function(json){
                                                        //Get first 5 response results
                                                        $scope.tags = json.data.data.slice(0,5);
                                                    });
                                        }
                            h3 Displaying the response
                            p Javascript
                                pre.prettyprint.
                                    .then(function(json){
                                        //Get first 5 response results
                                        $scope.tags = json.data.data.slice(0,5);
                                    });
                            p HTML
                                pre.prettyprint(ng-non-bindable).
                                    &lt;table ng-show="tags" class="table table-condensed table-hover"&gt;
                                        &lt;thead&gt;
                                            &lt;td&gt;Tag Name&lt;/td&gt;
                                            &lt;td&gt;Media Count&lt;/td&gt;
                                        &lt;/thead&gt;
                                        &lt;tr ng-repeat="tag in tags"&gt;
                                            &lt;td&gt;{{tag.name}}&lt;/td&gt;
                                            &lt;td&gt;{{tag.media_count}}&lt;/td&gt;
                                        &lt;/tr&gt;
                                    &lt;/table&gt;

    //-JS Implementing Plugins
    script(type='text/javascript',src='/plugins/prettify.js')
    //-JS Page Level
    script(type='text/javascript').
        var app = angular.module('myApp', []);
        app.controller('myCtrl', function($scope, $http) {
            //Get token from URL
            var urlToken = location.hash.split("access_token=")[1];
            if(urlToken !== null){
                $scope.accessToken = urlToken;
            }
            //Search for tag data
            $scope.getTagData = function(){
                $scope.message = null;
                //Validate input
                if($scope.searchQuery === undefined){
                    $scope.message = "Please enter search criteria";
                }
                //Send http request to API
                else{
                    $http.jsonp('https://api.instagram.com/v1/tags/search?' +
                            'q=' + $scope.searchQuery +
                            '&access_token=' + $scope.accessToken +
                            '&callback=JSON_CALLBACK')
                            .then(function(json){
                                //Get first 5 response results
                                $scope.tags = json.data.data.slice(0,5);
                            });
                }
            }
        });
