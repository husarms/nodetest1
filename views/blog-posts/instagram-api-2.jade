extends ../layout

block content
    style(text='text/css').
        pre.prettyprint {
            border: 1px solid #ccc;
            margin-bottom: 0;
            padding: 9.5px;
            white-space: pre-wrap;
        }
    div.breadcrumbs
        div.container
            a(href='/blog')
                h1.pull-left Blog
            ul.pull-right.breadcrumb
                li
                    a(href='/') Home
                li
                    a(href='/blog') Blog
                li.active
                    a(href='')=title
    //-End Breadcrumbs
    div.container.content-sm
        div.news-v3.margin-bottom-60
            div.news-v3-in.bg-color-darker.col-md-10.col-md-offset-1
                div.row
                    div.col-md-10.col-md-offset-1
                        div(ng-app="myApp" ng-controller="myCtrl")
                            //-img.img-responsive.margin-bottom-20(src='/images/blog/instagram-api/instagram-title.png',alt='')
                            h2.Title=title
                            small &nbsp;
                            ul.list-inline.posted-info
                                li Matt Husar
                                li April 29, 2016
                            hr
                            div.one-page-inner.bg-light
                                h3 Instagram API Demo - Get Recent Media
                                hr
                                //-Step 1 - Direct your user to our authorization URL
                                div(ng-show="accessToken == null")
                                    p
                                        a.btn-u.btn-brd-hover(type="button" href='https://api.instagram.com/oauth/authorize/?client_id=2aaa8ce013bc4a1291054e1ff79481f4&redirect_uri={{baseUrl}}&response_type=token') Click Here for Access Token
                                //-Step 2 - Request Data
                                div(ng-show="accessToken != null")
                                    p.
                                        <i class="fa fa-check-square-o"></i> Access granted - token = {{accessToken}}
                                    p
                                        div.input-group
                                            span.input-group-btn
                                                button.btn-u.btn-brd-hover(type="button",ng-click='getTagData()') <i class="fa fa-search"></i> Search Tags
                                            input.form-control(type="text", placeholder="Enter a tag name", ng-model="searchQuery", maxlength="30")
                                    div.alert.alert-warning(ng-hide="message == null")
                                        a.close(ng-click="message = null", aria-label="close") &times;
                                        p {{message}}
                                    table.table.table-condensed.table-hover(ng-show="tags")
                                        thead
                                            td Tag Name
                                            td Media Count
                                            td Recent Media
                                        tr(ng-repeat="tag in tags")
                                            td {{tag.name}}
                                            td {{tag.media_count}}
                                            td
                                                a(type='button', ng-click='getRecentMedia(tag.name)') Get recent media for '{{tag.name}}'
                                    div(ng-show="media")
                                        p Recent Media
                                        p(ng-repeat="item in media")
                                            img(src='{{item.images.standard_resolution.url}}', alt='instagram-image')


    //-JS Implementing Plugins
    script(type='text/javascript',src='/plugins/prettify.js')
    //-JS Page Level
    script(type='text/javascript').
        var app = angular.module('myApp', []);
        app.controller('myCtrl', function($scope, $http) {
            $scope.baseUrl = location.origin + location.pathname;
            //Get token from URL
            var urlToken = location.hash.split("access_token=")[1];
            if(urlToken !== null){
                $scope.accessToken = urlToken;
            }
            //Search for tag data
            $scope.getTagData = function(){
                $scope.message = null;
                //Validate input
                if($scope.searchQuery === undefined){
                    $scope.message = "Please enter search criteria";
                }
                //Send http request to API
                else{
                    $http.jsonp('https://api.instagram.com/v1/tags/search?' +
                                    'q=' + $scope.searchQuery +
                                    '&access_token=' + $scope.accessToken +
                                    '&callback=JSON_CALLBACK')
                        .then(function(json){
                            //Get first 5 response results
                            if(json.data.data !== undefined){
                                $scope.tags = json.data.data.slice(0, 5);
                            }
                            if (json.data.meta.error_message !== undefined) {
                                $scope.message = json.data.meta.error_message;
                            }
                        });
                }
            }
            //Get recent media with tag
            $scope.getRecentMedia = function(tag){
                $http.jsonp('https://api.instagram.com/v1/tags/' + tag + '/media/recent?' +
                        'access_token=375282163.1677ed0.0592e3a5d55948daa7afef4623e29e03' +
                        '&callback=JSON_CALLBACK')
                    .then(function (json) {
                        //Get first 5 response results
                        if(json.data.data !== undefined){
                            $scope.media = json.data.data.slice(0, 5);
                        }
                        if(json.data.meta.error_message !== undefined){
                            $scope.message = json.data.meta.error_message;
                        }
                    });
            }
        });
